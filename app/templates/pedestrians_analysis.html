{% extends "base.html" %}

{% block title %}Pedestrian Analysis{% endblock %}

{% block content %}
<div class="container">
    <h2>Pedestrian Analysis</h2>
    <p>Upload a video to analyze pedestrian activity and view real-time events.</p>

    <!-- Video Upload Form -->
    <form id="pedestrian-upload-form" enctype="multipart/form-data">
        <div class="mb-3">
            <label for="pedestrian-video-input" class="form-label">Select Video File:</label>
            <input class="form-control" type="file" id="pedestrian-video-input" accept="video/*">
        </div>
        <button type="submit" class="btn btn-primary">Upload and Analyze</button>
    </form>

    <!-- Upload Loading Bar -->
    <div id="pedestrian-upload-loading-bar" class="progress mt-3" style="display: none;">
        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
    </div>

    <!-- Video Display Area -->
    <div id="pedestrian-video-container" class="mt-4">
        <!-- Video element will be added here by JavaScript -->
        <p class="text-center text-muted">Upload a video to see the analysis here.</p>
    </div>

    <!-- Pedestrian Events Table -->
    <h3 class="mt-4">Pedestrian Events</h3>
     <button id="export-pedestrian-events-btn" class="btn btn-primary btn-sm mb-3 me-2">Export Events</button>
     <button id="clear-pedestrian-files-btn" class="btn btn-danger btn-sm mb-3">Clear Files</button>
    <div style="max-height: 600px; overflow-y: auto;">
        <table class="table table-striped table-hover table-sm critical-events-table-compact">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Time</th>
                    <th>Pedestrian ID</th>
                    <th>Intent Score (%)</th>
                    <th>Speed</th>
                    <th>Status</th>
                    <th>Location</th>
                </tr>
            </thead>
            <tbody id="pedestrian-events-table">
                <!-- Pedestrian events populated dynamically -->
            </tbody>
        </table>
    </div>

</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script src="{{ url_for('static', filename='js/utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/pedestrianAnalysis.js') }}"></script>
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const exportButton = document.getElementById('export-pedestrian-events-btn');
        if (exportButton) {
            exportButton.addEventListener('click', exportPedestrianEvents);
        }

        const clearButton = document.getElementById('clear-pedestrian-files-btn');
        if (clearButton) {
            clearButton.addEventListener('click', clearPedestrianFiles);
        }
    });
</script>
{% endblock %} 